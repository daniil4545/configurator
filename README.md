Программа создана для конфигурации счетчиков путем массовой рассылки СМС.
## Алгоритм работы

1. **Создание таблицы типа Excel.**
    
    Таблица, загружаемая в программу должна иметь столбцы:
    
    1. Номер телефона формата 7xxxxxxxxxx
    2. Порт
    3. Сообщение (опционально)
    
    Таблица создается вручную. Название столбцов строгое (по названию столбце делается поиск параметров в программе).
    
2. **Загрузка таблицы с данными счетчиков в программу.**
    
    Загрузка таблицы и обработка ее данных осуществляется модулем excel.py. Модуль содержит функцию read_from_excel, которая является улучшенной версией метода read_excel библиотеки pd. Функция осуществляет загрузку таблицы excel, проверку номеров телефона и портов на наличие недопустимых символов , а также генерирует сообщения если таковых нет в таблице (для Меркурия). После этого составляется словарь вида [номер : сообщение].
    
3. **Загрузка данных в БД.**
    
    Для создания БД используется библиотека SQLite. Методы БД описаны в модуле database.py. БД включает в себя колонки:
    
    1. id
    2. Номер телефона
    3. Отправленное сообщение
    4. Ответное сообщение
    5. Дата получения ответа
    
    БД используется для удобства контроля поступающих ответов от счетчиков. 
    
    После загрузки данные сохраняются в БД с пустыми столбцами 'Ответное сообщение' и 'Дата ответа'. Эти поля заполняются автоматически при поступлении ответа от счетчиков.
    
4. **Рассылка SMS сообщений.**
    
    Для рассылки SMS сообщений использован SMS-шлюз, созданный на базе Android смартфона и приложения [SMS Gateway](https://docs.sms-gate.app/). Приложение, позволяет вам программно отправлять SMS-сообщения через API и получать веб-хуки на входящие SMS. Для отправки SMS необходимо корректно указать IP-адрес шлюза и настроить аутентификацию а также зарегистрировать веб-хук.
    
    Функция отправки SMS сообщений описана в модуле sms.py. При вызове функции отправляется POST запрос (включающий номер телефона и сообщение) на шлюз/смартфон, который рассылает SMS конечным адресатам.
    
5. **Ожидание ответных SMS.**
    
    Приложение SMS Gateway имеет возможность отправки обратных http запросов, т.е. веб-хуков, при получении входящих SMS. Для получения веб-хуков необходим публичный сервер с сертификатом SSL. Сервер создан на базе фреймворка Flask, публичность и защищенность осуществляется сервисом ngrok.
    
    После рассылки SMS запускается клиент, ожидающий данных от шлюза. Когда шлюз получает ответное SMS он формирует POST запрос и передает данные в формате json. На стороне клиента происходит распаковка данных, вычленение номера отправителя и сообщения. Далее происходит обновление БД: по номеру телефона происходит поиск строки, в которую заносятся сообщение и дата получения.
    
    Также создана страница для удобства просмотра данных из БД.
   ## Как заупустить программу
   Перед запуском программы сформируйте таблицу Excel и скопируйте ее путь (Файл - Скопировать как путь), а также настройте SMS Gateway (Cloud Server). Для запуска программы запустить файл app.py и задайте конфигурационные данные.
   
